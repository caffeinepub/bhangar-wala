{
  "kind": "build_request",
  "title": "Revert to phone OTP login flow",
  "projectName": "Bhangar Wala",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-57",
      "text": "Restore the Login screen (`/login`) to the original phone OTP flow: display a phone number input field, a country code selector defaulting to +91, a 'Send OTP' button, and a terms & conditions checkbox. On submitting a valid phone number, navigate to `/otp-verification` and store the phone number in component state. Remove the Internet Identity 'Sign In' button and any II-related error/retry UI from this screen.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Keep phone OTP — no change needed, works as-was."
        ]
      },
      "acceptanceCriteria": [
        "The /login route renders a phone number input with country code selector defaulting to +91",
        "A 'Send OTP' button is present and navigates to /otp-verification on valid phone number submission",
        "A terms & conditions checkbox is present",
        "The Internet Identity 'Sign In' button is not present on the login screen",
        "No II-related error state or retry button is shown on the login screen"
      ]
    },
    {
      "id": "REQ-58",
      "text": "Restore the `/otp-verification` route and the OTP Verification page. The page must render 6 individual digit input boxes, a 60-second countdown timer, a 'Resend OTP' button (enabled only after the timer expires), and a 'Verify' button. On successful verification (accept any 6-digit code), navigate first-time users to `/profile-setup` and returning users to `/home`. Store the auth session in localStorage. Include the helper hint 'Enter any 6-digit code to verify' below the digit input boxes.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Keep phone OTP — no change needed, works as-was."
        ]
      },
      "acceptanceCriteria": [
        "The /otp-verification route is registered and accessible",
        "6 individual digit input boxes are rendered",
        "A 60-second countdown timer is shown",
        "The 'Resend OTP' button is disabled until the timer expires",
        "Submitting any valid 6-digit code navigates to /profile-setup for new users or /home for returning users",
        "Auth session is saved to localStorage on success",
        "The helper hint 'Enter any 6-digit code to verify' is visible below the input boxes"
      ]
    },
    {
      "id": "REQ-59",
      "text": "Restore the Profile Setup screen (`/profile-setup`) to use the phone number stored in localStorage (set during OTP login) as the user identifier when calling the backend `createUserProfile` method. Make the phone field on the profile setup form required (not optional), consistent with the phone-OTP-based auth flow.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Keep phone OTP — no change needed, works as-was."
        ]
      },
      "acceptanceCriteria": [
        "Profile Setup reads the phone number from localStorage set during OTP verification",
        "The phone field on the profile setup form is required",
        "createUserProfile is called with the phone-based user ID, not an Internet Identity principal"
      ]
    },
    {
      "id": "REQ-60",
      "text": "Restore the Splash screen (`/splash`) redirect logic to use localStorage session detection (not Internet Identity initialization state) to determine whether to redirect to `/home` (authenticated) or `/login` (unauthenticated).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Keep phone OTP — no change needed, works as-was."
        ]
      },
      "acceptanceCriteria": [
        "The splash screen checks localStorage for an auth session",
        "Authenticated users (session in localStorage) are redirected to /home",
        "Unauthenticated users are redirected to /login",
        "The redirect does not depend on Internet Identity initialization"
      ]
    },
    {
      "id": "REQ-61",
      "text": "Restore the Profile screen (`/profile`) logout action to clear the localStorage auth session and redirect to `/login`, without calling any Internet Identity logout method.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Keep phone OTP — no change needed, works as-was."
        ]
      },
      "acceptanceCriteria": [
        "Tapping 'Logout' clears localStorage and redirects to /login",
        "No Internet Identity logout call is made on the standard user logout action"
      ]
    }
  ],
  "constraints": [
    "Do not modify any Internet Identity hook files under frontend/src/hooks/useInternetIdentity.ts",
    "Do not modify frontend/src/main.tsx",
    "The backend data model and API methods must not change",
    "Admin, partner panel, and shop registration flows must remain unaffected"
  ],
  "nonGoals": [
    "Any changes to Internet Identity integration",
    "Any backend schema or data migration",
    "Changes to the service worker (frontend/public/sw.js) beyond what is needed for the OTP revert",
    "Changes to admin, partner panel, or scrap shop registration screens"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}