{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-25T08:42:58.358Z",
  "summary": "The diff implements fixes for REQ-64, REQ-65, and REQ-66. Frontend pages (AddAddress, BookPickup, EditAddress) and useQueries.ts are updated with validation, error handling, and correct data serialisation. backend/main.mo is modified. However, a key issue in useQueries.ts for the addAddress mutation shows lat/lng are set to undefined (not null) in the newAddress object. The backend migration.mo is added as a new file. Overall coverage is reasonable but the lat/lng null serialisation AC appears unmet.",
  "missing_requirements": [
    {
      "id": "REQ-64",
      "requirement": "Optional lat/lng fields are serialised as null (not undefined or empty string) when not provided",
      "reason": "In the useAddAddress mutation in useQueries.ts, the newAddress object sets lat: addressData.lat ?? undefined and lng: addressData.lng ?? undefined, which means when lat/lng are null they become undefined, violating the AC that they must be null not undefined.",
      "evidence": [
        "frontend/src/hooks/useQueries.ts"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "backend/migration.mo - a full data migration module for transforming OldBooking to NewBooking by adding an address field",
      "reason": "The build request does not mention any data migration module or schema migration. This is an additional feature not requested in REQ-64, REQ-65, or REQ-66.",
      "evidence": [
        "backend/migration.mo"
      ]
    },
    {
      "description": "EditAddress page with full edit/update address flow including validation and navigation",
      "reason": "The build request does not mention adding or fixing an Edit Address screen. The requirements only cover the Add Address screen and Book Pickup screen.",
      "evidence": [
        "frontend/src/pages/EditAddress.tsx"
      ]
    }
  ],
  "confidence": 0.62,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "frontend-file-summaries.txt",
    "frontend/src/hooks/useQueries.ts",
    "frontend/src/pages/AddAddress.tsx",
    "frontend/src/pages/Addresses.tsx",
    "frontend/src/pages/AdminBookings.tsx",
    "frontend/src/pages/AdminDashboard.tsx",
    "frontend/src/pages/AdminPartners.tsx",
    "frontend/src/pages/AdminRates.tsx",
    "frontend/src/pages/AdminSupportTickets.tsx",
    "frontend/src/pages/BookPickup.tsx",
    "frontend/src/pages/BookingConfirmation.tsx",
    "frontend/src/pages/BookingDetails.tsx",
    "frontend/src/pages/Bookings.tsx",
    "frontend/src/pages/EditAddress.tsx",
    "frontend/src/pages/Home.tsx",
    "frontend/src/pages/PartnerPanel.tsx",
    "frontend/src/pages/Payment.tsx",
    "frontend/src/pages/PaymentSuccess.tsx",
    "frontend/src/pages/RateService.tsx",
    "frontend/src/pages/ShopRegister.tsx",
    "frontend/src/pages/TrackPickup.tsx",
    "project_state.json"
  ]
}